# Xray ä»£ç†ç®¡ç†å·¥å…· - å®Œæ•´ä¸­æ–‡æ‰‹å†Œ

## ðŸ“– ç›®å½•

1. [å·¥å…·ç®€ä»‹](#å·¥å…·ç®€ä»‹)
2. [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [èŠ‚ç‚¹ç®¡ç†](#èŠ‚ç‚¹ç®¡ç†)
5. [ä»£ç†æ¨¡å¼](#ä»£ç†æ¨¡å¼)
6. [è·¯ç”±æ¨¡å¼](#è·¯ç”±æ¨¡å¼)
7. [é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™](#é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™)
8. [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
9. [å®Œæ•´ä½¿ç”¨æµç¨‹](#å®Œæ•´ä½¿ç”¨æµç¨‹)
10. [æ•…éšœæŽ’æŸ¥](#æ•…éšœæŽ’æŸ¥)

---

## å·¥å…·ç®€ä»‹

è¿™æ˜¯ä¸€å¥—å®Œæ•´çš„ Xray ä»£ç†ç®¡ç†å·¥å…·ï¼Œä¸“ä¸º Linux æœåŠ¡å™¨è®¾è®¡ï¼Œç‰¹åˆ«é€‚åˆæ— æ¡Œé¢çŽ¯å¢ƒçš„æœåŠ¡å™¨ä½¿ç”¨ã€‚

### åŒ…å«çš„è„šæœ¬

| è„šæœ¬åç§° | åŠŸèƒ½è¯´æ˜Ž |
|---------|---------|
| `xray-proxy-manager.sh` | ä¸»ç®¡ç†è„šæœ¬ï¼Œç»Ÿä¸€å…¥å£ |
| `xray-config-generator.sh` | ä»Žåˆ†äº«é“¾æŽ¥ç”Ÿæˆå®Œæ•´é…ç½® |
| `xray-node-manager.sh` | å¤šèŠ‚ç‚¹ç®¡ç†å·¥å…· |
| `xray-routing-mode.sh` | è·¯ç”±æ¨¡å¼åˆ‡æ¢å·¥å…· |
| `tproxy-bypass.conf` | é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™é…ç½® |

---

## åŠŸèƒ½ç‰¹æ€§

### âœ… æ ¸å¿ƒåŠŸèƒ½

1. **ä¸€é”®ç”Ÿæˆé…ç½®** - ä»Ž vless/vmess åˆ†äº«é“¾æŽ¥ç›´æŽ¥ç”Ÿæˆå®Œæ•´çš„ config.json
2. **å¤šèŠ‚ç‚¹ç®¡ç†** - ä¿å­˜å¤šä¸ªèŠ‚ç‚¹ï¼Œéšæ—¶åˆ‡æ¢ï¼Œå¯åŠ¨æ—¶å¯é€‰æ‹©
3. **ç³»ç»Ÿä»£ç†** - è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼Œæ”¯æŒ GNOME/KDE æ¡Œé¢
4. **é€æ˜Žä»£ç†** - åŸºäºŽ iptables çš„å…¨å±€é€æ˜Žä»£ç†
5. **æŽ’é™¤è§„åˆ™** - çµæ´»çš„é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™ï¼ˆæŒ‰ç”¨æˆ·ã€IPã€ç«¯å£ç­‰ï¼‰
6. **è·¯ç”±æ¨¡å¼åˆ‡æ¢** - ç»•è¿‡å¤§é™†/å…¨å±€ä»£ç†/ç›´è¿žä¸‰ç§æ¨¡å¼
7. **æœåŠ¡ç®¡ç†** - å¯åŠ¨/åœæ­¢/é‡å¯/çŠ¶æ€æŸ¥çœ‹
8. **è¿žæŽ¥æµ‹è¯•** - æµ‹è¯•ä»£ç†æ˜¯å¦æ­£å¸¸å·¥ä½œ

### ðŸŽ¯ é€‚ç”¨åœºæ™¯

- âœ… æ— æ¡Œé¢çŽ¯å¢ƒçš„ Linux æœåŠ¡å™¨
- âœ… éœ€è¦ç®¡ç†å¤šä¸ªä»£ç†èŠ‚ç‚¹
- âœ… éœ€è¦å…¨å±€é€æ˜Žä»£ç†
- âœ… éœ€è¦çµæ´»çš„è·¯ç”±è§„åˆ™
- âœ… éœ€è¦æŽ’é™¤ç‰¹å®šåº”ç”¨æˆ–æœåŠ¡

---

## å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡è„šæœ¬

```bash
# ä¸‹è½½æ‰€æœ‰è„šæœ¬åˆ°åŒä¸€ç›®å½•
cd /path/to/scripts

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x xray-*.sh
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# Debian/Ubuntu
sudo apt update
sudo apt install jq curl unzip

# CentOS/RHEL
sudo yum install jq curl unzip
```

### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ èŠ‚ç‚¹

```bash
# ä½¿ç”¨ä½ çš„ vless åˆ†äº«é“¾æŽ¥
./xray-proxy-manager.sh node-add "vless://uuid@server:443?..." "æˆ‘çš„èŠ‚ç‚¹"

# æˆ–è€…è®©å·¥å…·è‡ªåŠ¨ä»Žé“¾æŽ¥æå–åç§°
./xray-proxy-manager.sh node-add "vless://...#èŠ‚ç‚¹åç§°"
```

### ç¬¬å››æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
sudo ./xray-proxy-manager.sh start
```

å¯åŠ¨æ—¶ä¼šæç¤ºï¼š
1. æ˜¯å¦é€‰æ‹©èŠ‚ç‚¹ï¼ˆå¦‚æžœæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼‰
2. é€‰æ‹©ä»£ç†æ¨¡å¼ï¼ˆç³»ç»Ÿä»£ç†/é€æ˜Žä»£ç†/ä¸¤è€…/ä¸é…ç½®ï¼‰

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•è¿žæŽ¥

```bash
./xray-proxy-manager.sh test
```

---

## èŠ‚ç‚¹ç®¡ç†

### æ·»åŠ èŠ‚ç‚¹

```bash
# åŸºæœ¬ç”¨æ³•
./xray-proxy-manager.sh node-add "åˆ†äº«é“¾æŽ¥" "èŠ‚ç‚¹åç§°"

# ç¤ºä¾‹
./xray-proxy-manager.sh node-add "vless://..." "ç¾Žå›½èŠ‚ç‚¹"
./xray-proxy-manager.sh node-add "vless://..." "æ—¥æœ¬èŠ‚ç‚¹"
./xray-proxy-manager.sh node-add "vless://..." "é¦™æ¸¯èŠ‚ç‚¹"

# è‡ªåŠ¨å‘½åï¼ˆä»Žé“¾æŽ¥çš„ # åŽé¢æå–ï¼‰
./xray-proxy-manager.sh node-add "vless://...#US-Server"
```

### æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹

```bash
./xray-proxy-manager.sh node-list
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
=== å¯ç”¨èŠ‚ç‚¹ ===

  1) ç¾Žå›½èŠ‚ç‚¹ (å½“å‰)
  2) æ—¥æœ¬èŠ‚ç‚¹
  3) é¦™æ¸¯èŠ‚ç‚¹
```

### åˆ‡æ¢èŠ‚ç‚¹

**æ–¹æ³•ä¸€ï¼šäº¤äº’å¼é€‰æ‹©**
```bash
./xray-proxy-manager.sh node-select
```

**æ–¹æ³•äºŒï¼šç›´æŽ¥åˆ‡æ¢**
```bash
./xray-proxy-manager.sh node-switch æ—¥æœ¬èŠ‚ç‚¹
```

### æŸ¥çœ‹å½“å‰èŠ‚ç‚¹

```bash
./xray-proxy-manager.sh node-current
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
=== å½“å‰èŠ‚ç‚¹ ===
åç§°: ç¾Žå›½èŠ‚ç‚¹
é…ç½®: /usr/local/etc/xray/nodes/ç¾Žå›½èŠ‚ç‚¹.json
æœåŠ¡å™¨: 190.93.246.238:443
åè®®: vless
```

### åˆ é™¤èŠ‚ç‚¹

```bash
./xray-proxy-manager.sh node-delete æ—¥æœ¬èŠ‚ç‚¹
```

---

## ä»£ç†æ¨¡å¼

### ç³»ç»Ÿä»£ç†æ¨¡å¼

**é€‚ç”¨åœºæ™¯ï¼š** æ¡Œé¢çŽ¯å¢ƒï¼Œæˆ–åªéœ€è¦éƒ¨åˆ†ç¨‹åºä½¿ç”¨ä»£ç†

**ç‰¹ç‚¹ï¼š**
- è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼ˆHTTP_PROXY, HTTPS_PROXY, ALL_PROXYï¼‰
- æ”¯æŒ GNOME/KDE æ¡Œé¢çŽ¯å¢ƒ
- æ–°å¯åŠ¨çš„ç¨‹åºä¼šè‡ªåŠ¨ä½¿ç”¨ä»£ç†
- å·²è¿è¡Œçš„ç¨‹åºä¸å—å½±å“ï¼ˆéœ€è¦é‡å¯ç¨‹åºï¼‰

**å¯ç”¨ç³»ç»Ÿä»£ç†ï¼š**
```bash
sudo ./xray-proxy-manager.sh proxy-on
```

**å½“å‰ç»ˆç«¯ç«‹å³ä½¿ç”¨ä»£ç†ï¼š**
```bash
source /etc/profile.d/xray-proxy.sh
```

**ç¦ç”¨ç³»ç»Ÿä»£ç†ï¼š**
```bash
sudo ./xray-proxy-manager.sh proxy-off
```

### é€æ˜Žä»£ç†æ¨¡å¼

**é€‚ç”¨åœºæ™¯ï¼š** æœåŠ¡å™¨çŽ¯å¢ƒï¼Œéœ€è¦å…¨å±€ä»£ç†

**ç‰¹ç‚¹ï¼š**
- åŸºäºŽ iptables TPROXY å®žçŽ°
- æ‰€æœ‰æµé‡è‡ªåŠ¨èµ°ä»£ç†ï¼ˆåŒ…æ‹¬å·²è¿è¡Œçš„ç¨‹åºï¼‰
- æ”¯æŒ TCP å’Œ UDP
- å¯é…ç½®æŽ’é™¤è§„åˆ™

**å¯ç”¨é€æ˜Žä»£ç†ï¼š**
```bash
sudo ./xray-proxy-manager.sh tproxy-on
```

**ç¦ç”¨é€æ˜Žä»£ç†ï¼š**
```bash
sudo ./xray-proxy-manager.sh tproxy-off
```

### æŸ¥çœ‹ä»£ç†çŠ¶æ€

```bash
./xray-proxy-manager.sh proxy-status
```

---

## è·¯ç”±æ¨¡å¼

è·¯ç”±æ¨¡å¼å†³å®šå“ªäº›æµé‡èµ°ä»£ç†ï¼Œå“ªäº›æµé‡ç›´è¿žã€‚

### ä¸‰ç§è·¯ç”±æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜Ž | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **bypass-cn** | å›½å†…ç›´è¿žï¼Œå›½å¤–èµ°ä»£ç† | æ—¥å¸¸ä½¿ç”¨ï¼ˆæŽ¨èï¼‰ |
| **global** | å…¨å±€ä»£ç†ï¼Œæ‰€æœ‰æµé‡èµ°ä»£ç† | éœ€è¦å®Œå…¨éšè— IP |
| **direct** | å…¨éƒ¨ç›´è¿žï¼Œä¸ä½¿ç”¨ä»£ç† | ä¸´æ—¶ç¦ç”¨ä»£ç† |

### åˆ‡æ¢è·¯ç”±æ¨¡å¼

```bash
# ç»•è¿‡å¤§é™†æ¨¡å¼ï¼ˆæŽ¨èï¼‰
sudo ./xray-proxy-manager.sh route-mode bypass-cn

# å…¨å±€ä»£ç†æ¨¡å¼
sudo ./xray-proxy-manager.sh route-mode global

# ç›´è¿žæ¨¡å¼
sudo ./xray-proxy-manager.sh route-mode direct
```

### æŸ¥çœ‹å½“å‰è·¯ç”±æ¨¡å¼

```bash
./xray-proxy-manager.sh route-status
```

### äº¤äº’å¼é€‰æ‹©è·¯ç”±æ¨¡å¼

```bash
sudo ./xray-routing-mode.sh interactive
```

---

## é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™

é€æ˜Žä»£ç†é»˜è®¤ä¼šä»£ç†æ‰€æœ‰æµé‡ï¼Œä½†ä½ å¯ä»¥é…ç½®æŽ’é™¤è§„åˆ™ã€‚

### é…ç½®æ–‡ä»¶ä½ç½®

```bash
/usr/local/etc/xray/tproxy-bypass.conf
```

### äº”ç§æŽ’é™¤æ–¹å¼

#### 1. æŒ‰ç”¨æˆ·æŽ’é™¤ï¼ˆæŽ¨èï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** æŽ’é™¤ç‰¹å®šæœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€Web æœåŠ¡å™¨ï¼‰

```bash
# åˆ›å»ºä¸“ç”¨ç”¨æˆ·
sudo useradd -r -s /bin/false noproxy

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vi /usr/local/etc/xray/tproxy-bypass.conf

# æ·»åŠ 
BYPASS_USERS=(
    "noproxy"
    "mysql"
    "nginx"
)

# é‡æ–°å¯ç”¨é€æ˜Žä»£ç†
sudo ./xray-proxy-manager.sh tproxy-off
sudo ./xray-proxy-manager.sh tproxy-on

# ä»¥è¯¥ç”¨æˆ·è¿è¡Œç¨‹åº
sudo -u noproxy python my_app.py
```

#### 2. æŒ‰ UID æŽ’é™¤

```bash
# ç¼–è¾‘é…ç½®
BYPASS_UIDS=(
    1001
    1002
)
```

#### 3. æŒ‰ç›®æ ‡ IP/ç½‘æ®µæŽ’é™¤

**é€‚ç”¨åœºæ™¯ï¼š** æŽ’é™¤è®¿é—®å†…ç½‘æœåŠ¡å™¨çš„æµé‡

```bash
BYPASS_IPS=(
    "192.168.1.0/24"    # æ•´ä¸ªå†…ç½‘æ®µ
    "10.0.0.50"         # ç‰¹å®šæœåŠ¡å™¨
)
```

#### 4. æŒ‰ç›®æ ‡ç«¯å£æŽ’é™¤

**é€‚ç”¨åœºæ™¯ï¼š** æŽ’é™¤ç‰¹å®šæœåŠ¡ç«¯å£

```bash
BYPASS_PORTS=(
    22        # SSH
    3306      # MySQL
    5432      # PostgreSQL
    6379      # Redis
)
```

#### 5. æŒ‰æºç«¯å£æŽ’é™¤

```bash
BYPASS_SOURCE_PORTS=(
    8080
    9000
)
```

### é¢„å®šä¹‰è§„åˆ™é›†

```bash
# æŽ’é™¤æ•°æ®åº“æœåŠ¡
enable_database_bypass

# æŽ’é™¤æœ¬åœ°å¼€å‘æœåŠ¡
enable_dev_bypass

# æŽ’é™¤ Web æœåŠ¡å™¨
enable_webserver_bypass
```

### åº”ç”¨æŽ’é™¤è§„åˆ™

ä¿®æ”¹é…ç½®åŽï¼Œéœ€è¦é‡æ–°å¯ç”¨é€æ˜Žä»£ç†ï¼š

```bash
sudo ./xray-proxy-manager.sh tproxy-off
sudo ./xray-proxy-manager.sh tproxy-on
```

### éªŒè¯æŽ’é™¤è§„åˆ™

```bash
# æŸ¥çœ‹ iptables è§„åˆ™
sudo iptables -t mangle -L XRAY -n -v

# æµ‹è¯•æŽ’é™¤çš„ç”¨æˆ·
sudo -u noproxy curl http://ipinfo.io/ip  # åº”æ˜¾ç¤ºçœŸå®ž IP

# æµ‹è¯•æ™®é€šç”¨æˆ·
curl http://ipinfo.io/ip  # åº”æ˜¾ç¤ºä»£ç† IP
```

---

## å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆå«èŠ‚ç‚¹é€‰æ‹©ï¼‰
sudo ./xray-proxy-manager.sh start

# åœæ­¢æœåŠ¡å¹¶æ¸…ç†ä»£ç†è®¾ç½®
sudo ./xray-proxy-manager.sh stop

# é‡å¯æœåŠ¡å¹¶ä¿æŒä»£ç†è®¾ç½®
sudo ./xray-proxy-manager.sh restart

# æŸ¥çœ‹çŠ¶æ€
./xray-proxy-manager.sh status
```

### èŠ‚ç‚¹ç®¡ç†

```bash
# æ·»åŠ èŠ‚ç‚¹
./xray-proxy-manager.sh node-add "vless://..." "èŠ‚ç‚¹å"

# åˆ—å‡ºèŠ‚ç‚¹
./xray-proxy-manager.sh node-list

# é€‰æ‹©èŠ‚ç‚¹
./xray-proxy-manager.sh node-select

# åˆ‡æ¢èŠ‚ç‚¹
./xray-proxy-manager.sh node-switch èŠ‚ç‚¹å

# æŸ¥çœ‹å½“å‰èŠ‚ç‚¹
./xray-proxy-manager.sh node-current

# åˆ é™¤èŠ‚ç‚¹
./xray-proxy-manager.sh node-delete èŠ‚ç‚¹å
```

### ä»£ç†ç®¡ç†

```bash
# å¯ç”¨ç³»ç»Ÿä»£ç†
sudo ./xray-proxy-manager.sh proxy-on

# ç¦ç”¨ç³»ç»Ÿä»£ç†
sudo ./xray-proxy-manager.sh proxy-off

# å¯ç”¨é€æ˜Žä»£ç†
sudo ./xray-proxy-manager.sh tproxy-on

# ç¦ç”¨é€æ˜Žä»£ç†
sudo ./xray-proxy-manager.sh tproxy-off

# æŸ¥çœ‹ä»£ç†çŠ¶æ€
./xray-proxy-manager.sh proxy-status
```

### è·¯ç”±æ¨¡å¼

```bash
# åˆ‡æ¢åˆ°ç»•è¿‡å¤§é™†æ¨¡å¼
sudo ./xray-proxy-manager.sh route-mode bypass-cn

# åˆ‡æ¢åˆ°å…¨å±€ä»£ç†æ¨¡å¼
sudo ./xray-proxy-manager.sh route-mode global

# åˆ‡æ¢åˆ°ç›´è¿žæ¨¡å¼
sudo ./xray-proxy-manager.sh route-mode direct

# æŸ¥çœ‹å½“å‰è·¯ç”±æ¨¡å¼
./xray-proxy-manager.sh route-status
```

### æµ‹è¯•å’Œæ—¥å¿—

```bash
# æµ‹è¯•ä»£ç†è¿žæŽ¥
./xray-proxy-manager.sh test

# æŸ¥çœ‹å®žæ—¶æ—¥å¿—
./xray-proxy-manager.sh logs

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo ./xray-proxy-manager.sh config

# é‡æ–°åŠ è½½é…ç½®
sudo ./xray-proxy-manager.sh reload
```

---

## å®Œæ•´ä½¿ç”¨æµç¨‹

### åœºæ™¯ä¸€ï¼šé¦–æ¬¡ä½¿ç”¨

```bash
# 1. å‡†å¤‡è„šæœ¬
chmod +x xray-*.sh

# 2. å®‰è£…ä¾èµ–
sudo apt install jq curl unzip

# 3. æ·»åŠ èŠ‚ç‚¹
./xray-proxy-manager.sh node-add "vless://..." "ä¸»èŠ‚ç‚¹"

# 4. å¯åŠ¨æœåŠ¡
sudo ./xray-proxy-manager.sh start
# é€‰æ‹©ï¼šä½¿ç”¨å½“å‰é…ç½®
# é€‰æ‹©ï¼šé€æ˜Žä»£ç†æ¨¡å¼

# 5. è®¾ç½®è·¯ç”±æ¨¡å¼
sudo ./xray-proxy-manager.sh route-mode bypass-cn

# 6. æµ‹è¯•
./xray-proxy-manager.sh test
```

### åœºæ™¯äºŒï¼šç®¡ç†å¤šä¸ªèŠ‚ç‚¹

```bash
# 1. æ·»åŠ å¤šä¸ªèŠ‚ç‚¹
./xray-proxy-manager.sh node-add "vless://..." "ç¾Žå›½èŠ‚ç‚¹"
./xray-proxy-manager.sh node-add "vless://..." "æ—¥æœ¬èŠ‚ç‚¹"
./xray-proxy-manager.sh node-add "vless://..." "é¦™æ¸¯èŠ‚ç‚¹"

# 2. æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
./xray-proxy-manager.sh node-list

# 3. å¯åŠ¨å¹¶é€‰æ‹©èŠ‚ç‚¹
sudo ./xray-proxy-manager.sh start
# é€‰æ‹©ï¼šé€‰æ‹©èŠ‚ç‚¹
# é€‰æ‹©èŠ‚ç‚¹ç¼–å·

# 4. éšæ—¶åˆ‡æ¢èŠ‚ç‚¹
sudo ./xray-proxy-manager.sh node-switch æ—¥æœ¬èŠ‚ç‚¹

# 5. æŸ¥çœ‹å½“å‰èŠ‚ç‚¹
./xray-proxy-manager.sh node-current
```

### åœºæ™¯ä¸‰ï¼šé…ç½®é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™

```bash
# 1. åˆ›å»ºæŽ’é™¤ç”¨æˆ·
sudo useradd -r -s /bin/false noproxy

# 2. ç¼–è¾‘æŽ’é™¤é…ç½®
sudo vi /usr/local/etc/xray/tproxy-bypass.conf

# æ·»åŠ å†…å®¹ï¼š
BYPASS_USERS=("noproxy")
BYPASS_PORTS=(3306 5432 6379)
BYPASS_IPS=("192.168.1.0/24")

# 3. å¯ç”¨é€æ˜Žä»£ç†
sudo ./xray-proxy-manager.sh tproxy-on

# 4. éªŒè¯æŽ’é™¤è§„åˆ™
sudo iptables -t mangle -L XRAY -n -v

# 5. æµ‹è¯•
sudo -u noproxy curl http://ipinfo.io/ip  # çœŸå®ž IP
curl http://ipinfo.io/ip  # ä»£ç† IP
```

### åœºæ™¯å››ï¼šåˆ‡æ¢è·¯ç”±æ¨¡å¼

```bash
# æ—¥å¸¸ä½¿ç”¨ï¼šç»•è¿‡å¤§é™†
sudo ./xray-proxy-manager.sh route-mode bypass-cn

# éœ€è¦å…¨å±€ä»£ç†æ—¶
sudo ./xray-proxy-manager.sh route-mode global

# ä¸´æ—¶ç¦ç”¨ä»£ç†
sudo ./xray-proxy-manager.sh route-mode direct

# æ¢å¤ç»•è¿‡å¤§é™†
sudo ./xray-proxy-manager.sh route-mode bypass-cn
```

---

## æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./xray-proxy-manager.sh status

# 2. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./xray-proxy-manager.sh logs

# 3. æµ‹è¯•é…ç½®æ–‡ä»¶
xray run -test -config /usr/local/etc/xray/config.json

# 4. æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E '10808|12345'

# 5. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u xray.service -n 50
```

**å¸¸è§åŽŸå› ï¼š**
- é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯
- ç«¯å£è¢«å ç”¨
- æƒé™ä¸è¶³
- xray æœªå®‰è£…

### é—®é¢˜ 2ï¼šä»£ç†æ— æ³•è¿žæŽ¥

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æµ‹è¯•ä»£ç†
./xray-proxy-manager.sh test

# 2. æŸ¥çœ‹å½“å‰èŠ‚ç‚¹
./xray-proxy-manager.sh node-current

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status xray.service

# 4. æŸ¥çœ‹è·¯ç”±æ¨¡å¼
./xray-proxy-manager.sh route-status

# 5. å°è¯•åˆ‡æ¢èŠ‚ç‚¹
sudo ./xray-proxy-manager.sh node-select
```

**å¸¸è§åŽŸå› ï¼š**
- èŠ‚ç‚¹å¤±æ•ˆ
- è·¯ç”±è§„åˆ™é”™è¯¯
- é˜²ç«å¢™é˜»æ­¢
- æœåŠ¡å™¨åœ°å€é”™è¯¯

### é—®é¢˜ 3ï¼šé€æ˜Žä»£ç†ä¸å·¥ä½œ

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥ iptables è§„åˆ™
sudo iptables -t mangle -L XRAY -n -v

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ dokodemo-door
grep -A 10 "dokodemo-door" /usr/local/etc/xray/config.json

# 3. æ£€æŸ¥ IP è½¬å‘
sysctl net.ipv4.ip_forward

# 4. æŸ¥çœ‹è·¯ç”±è¡¨
ip rule show
ip route show table 100

# 5. é‡æ–°å¯ç”¨é€æ˜Žä»£ç†
sudo ./xray-proxy-manager.sh tproxy-off
sudo ./xray-proxy-manager.sh tproxy-on
```

**å¸¸è§åŽŸå› ï¼š**
- é…ç½®æ–‡ä»¶ç¼ºå°‘ dokodemo-door å…¥ç«™
- iptables è§„åˆ™æœªç”Ÿæ•ˆ
- IP è½¬å‘æœªå¯ç”¨
- ç«¯å£é…ç½®é”™è¯¯

### é—®é¢˜ 4ï¼šç³»ç»Ÿä»£ç†ä¸ç”Ÿæ•ˆ

**åŽŸå› ï¼š** ç³»ç»Ÿä»£ç†åªå¯¹æ–°å¯åŠ¨çš„ç¨‹åºç”Ÿæ•ˆ

**è§£å†³æ–¹æ³•ï¼š**

```bash
# æ–¹æ³• 1ï¼šé‡å¯éœ€è¦ä»£ç†çš„ç¨‹åº
killall my_program
my_program &

# æ–¹æ³• 2ï¼šå½“å‰ç»ˆç«¯ç«‹å³ä½¿ç”¨ä»£ç†
source /etc/profile.d/xray-proxy.sh

# æ–¹æ³• 3ï¼šä½¿ç”¨é€æ˜Žä»£ç†ï¼ˆå¯¹æ‰€æœ‰ç¨‹åºç”Ÿæ•ˆï¼‰
sudo ./xray-proxy-manager.sh tproxy-on
```

### é—®é¢˜ 5ï¼šåˆ‡æ¢è·¯ç”±æ¨¡å¼å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥ jq æ˜¯å¦å®‰è£…
which jq

# 2. å®‰è£… jq
sudo apt install jq

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶å¤‡ä»½
ls -la /usr/local/etc/xray/config.json.backup

# 4. æ¢å¤å¤‡ä»½ï¼ˆå¦‚æžœéœ€è¦ï¼‰
sudo cp /usr/local/etc/xray/config.json.backup /usr/local/etc/xray/config.json

# 5. é‡æ–°åˆ‡æ¢
sudo ./xray-proxy-manager.sh route-mode bypass-cn
```

### é—®é¢˜ 6ï¼šèŠ‚ç‚¹æ·»åŠ å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥é…ç½®ç”Ÿæˆå™¨
ls -l xray-config-generator.sh

# 2. æ‰‹åŠ¨æµ‹è¯•ç”Ÿæˆ
./xray-config-generator.sh "vless://..." test.json

# 3. æŸ¥çœ‹ç”Ÿæˆçš„é…ç½®
cat test.json

# 4. æ£€æŸ¥èŠ‚ç‚¹ç›®å½•
ls -la /usr/local/etc/xray/nodes/

# 5. åˆ›å»ºèŠ‚ç‚¹ç›®å½•ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
sudo mkdir -p /usr/local/etc/xray/nodes
```

---

## é«˜çº§æŠ€å·§

### 1. åˆ›å»ºå¿«æ·å‘½ä»¤

```bash
# ç¼–è¾‘ ~/.bashrc
vi ~/.bashrc

# æ·»åŠ åˆ«å
alias xray-start='sudo /path/to/xray-proxy-manager.sh start'
alias xray-stop='sudo /path/to/xray-proxy-manager.sh stop'
alias xray-test='/path/to/xray-proxy-manager.sh test'
alias xray-status='/path/to/xray-proxy-manager.sh status'
alias xray-pac='sudo /path/to/xray-proxy-manager.sh route-mode bypass-cn'
alias xray-global='sudo /path/to/xray-proxy-manager.sh route-mode global'

# é‡æ–°åŠ è½½
source ~/.bashrc

# ä½¿ç”¨
xray-start
xray-test
xray-pac
```

### 2. æ‰¹é‡æ·»åŠ èŠ‚ç‚¹

```bash
# åˆ›å»ºèŠ‚ç‚¹åˆ—è¡¨æ–‡ä»¶
cat > nodes.txt <<EOF
vless://uuid1@server1:443?...#ç¾Žå›½èŠ‚ç‚¹
vless://uuid2@server2:443?...#æ—¥æœ¬èŠ‚ç‚¹
vless://uuid3@server3:443?...#é¦™æ¸¯èŠ‚ç‚¹
EOF

# æ‰¹é‡æ·»åŠ 
while IFS= read -r link; do
    ./xray-proxy-manager.sh node-add "$link"
done < nodes.txt
```

### 3. å¼€æœºè‡ªåŠ¨å¯åŠ¨

```bash
# åˆ›å»º systemd æœåŠ¡
sudo cat > /etc/systemd/system/xray-auto-start.service <<EOF
[Unit]
Description=Xray Auto Start with Transparent Proxy
After=network.target xray.service

[Service]
Type=oneshot
ExecStart=/path/to/xray-proxy-manager.sh tproxy-on
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
EOF

# å¯ç”¨æœåŠ¡
sudo systemctl enable xray-auto-start.service
```

### 4. ç›‘æŽ§å’Œå‘Šè­¦

```bash
# åˆ›å»ºç›‘æŽ§è„šæœ¬
cat > /usr/local/bin/xray-monitor.sh <<'EOF'
#!/bin/bash
if ! systemctl is-active --quiet xray.service; then
    echo "Xray service is down!" | mail -s "Xray Alert" your@email.com
    systemctl start xray.service
fi
EOF

chmod +x /usr/local/bin/xray-monitor.sh

# æ·»åŠ  cron ä»»åŠ¡ï¼ˆæ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
crontab -e
# æ·»åŠ ï¼š*/5 * * * * /usr/local/bin/xray-monitor.sh
```

---

## ç«¯å£è¯´æ˜Ž

| ç«¯å£ | åè®® | ç”¨é€” |
|------|------|------|
| 10808 | mixed | SOCKS5 + HTTP ä»£ç†ï¼ˆç³»ç»Ÿä»£ç†ï¼‰ |
| 12345 | dokodemo-door | é€æ˜Žä»£ç†ï¼ˆTPROXYï¼‰ |

---

## æ–‡ä»¶ä½ç½®

| æ–‡ä»¶/ç›®å½• | è¯´æ˜Ž |
|----------|------|
| `/usr/local/bin/xray` | Xray äºŒè¿›åˆ¶æ–‡ä»¶ |
| `/usr/local/etc/xray/config.json` | å½“å‰ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ |
| `/usr/local/etc/xray/nodes/` | ä¿å­˜çš„èŠ‚ç‚¹é…ç½®ç›®å½• |
| `/usr/local/etc/xray/tproxy-bypass.conf` | é€æ˜Žä»£ç†æŽ’é™¤è§„åˆ™é…ç½® |
| `/etc/systemd/system/xray.service` | Systemd æœåŠ¡æ–‡ä»¶ |
| `/etc/profile.d/xray-proxy.sh` | ç³»ç»Ÿä»£ç†çŽ¯å¢ƒå˜é‡ |
| `/tmp/xray-current-node` | å½“å‰èŠ‚ç‚¹æ ‡è®°æ–‡ä»¶ |
| `/tmp/xray-routing-mode` | å½“å‰è·¯ç”±æ¨¡å¼æ ‡è®°æ–‡ä»¶ |

---

## å®‰å…¨å»ºè®®

1. **å®šæœŸæ›´æ–° Xray**
   ```bash
   # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬å¹¶æ›¿æ¢
   sudo systemctl stop xray
   # ä¸‹è½½æ–°ç‰ˆæœ¬åˆ° /usr/local/bin/xray
   sudo systemctl start xray
   ```

2. **ä¿æŠ¤é…ç½®æ–‡ä»¶**
   ```bash
   sudo chmod 600 /usr/local/etc/xray/config.json
   sudo chown root:root /usr/local/etc/xray/config.json
   ```

3. **å®šæœŸå¤‡ä»½é…ç½®**
   ```bash
   sudo cp /usr/local/etc/xray/config.json ~/xray-backup-$(date +%Y%m%d).json
   ```

4. **ç›‘æŽ§æ—¥å¿—**
   ```bash
   ./xray-proxy-manager.sh logs
   ```

5. **ä½¿ç”¨å¼ºå¯†ç å’Œéšæœº UUID**
   ```bash
   # ç”Ÿæˆæ–°çš„ UUID
   uuidgen
   ```

---

## æ€»ç»“

è¿™å¥—å·¥å…·æä¾›äº†å®Œæ•´çš„ Xray ä»£ç†ç®¡ç†åŠŸèƒ½ï¼š

âœ… **ç®€å•æ˜“ç”¨** - ä¸€é”®æ·»åŠ èŠ‚ç‚¹ï¼Œäº¤äº’å¼æ“ä½œ
âœ… **åŠŸèƒ½å®Œæ•´** - æ”¯æŒç³»ç»Ÿä»£ç†ã€é€æ˜Žä»£ç†ã€è·¯ç”±åˆ‡æ¢
âœ… **çµæ´»é…ç½®** - å¤šèŠ‚ç‚¹ç®¡ç†ã€æŽ’é™¤è§„åˆ™ã€è·¯ç”±æ¨¡å¼
âœ… **é€‚åˆæœåŠ¡å™¨** - ä¸“ä¸ºæ— æ¡Œé¢çŽ¯å¢ƒè®¾è®¡
âœ… **ä¸­æ–‡å‹å¥½** - å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£

### æŽ¨èé…ç½®

**æ— æ¡Œé¢æœåŠ¡å™¨ï¼š**
- ä½¿ç”¨é€æ˜Žä»£ç†æ¨¡å¼
- é…ç½®ç»•è¿‡å¤§é™†è·¯ç”±
- è®¾ç½®æŽ’é™¤è§„åˆ™ï¼ˆæ•°æ®åº“ã€å†…ç½‘ç­‰ï¼‰
- ä¿å­˜å¤šä¸ªèŠ‚ç‚¹å¤‡ç”¨

**æ¡Œé¢çŽ¯å¢ƒï¼š**
- ä½¿ç”¨ç³»ç»Ÿä»£ç†æ¨¡å¼
- é…ç½®ç»•è¿‡å¤§é™†è·¯ç”±
- æ ¹æ®éœ€è¦åˆ‡æ¢èŠ‚ç‚¹

---

## èŽ·å–å¸®åŠ©

```bash
# æŸ¥çœ‹ä¸»è„šæœ¬å¸®åŠ©
./xray-proxy-manager.sh help

# æŸ¥çœ‹èŠ‚ç‚¹ç®¡ç†å¸®åŠ©
./xray-node-manager.sh help

# æŸ¥çœ‹è·¯ç”±æ¨¡å¼å¸®åŠ©
./xray-routing-mode.sh help
```

---

**ç‰ˆæœ¬ï¼š** 2.0.0
**æ›´æ–°æ—¥æœŸï¼š** 2026-02-09
**ä½œè€…ï¼š** Claude Code
**è®¸å¯è¯ï¼š** MIT
